singularity {
    enabled = true
    envWhitelist = "CUDA_VISIBLE_DEVICES"
}
report.enabled = true
container_dir = "/home/jgauthie/imgs"

process {
    /* executor = "slurm" */
    executor = "local"
    queue = "cpl"
    clusterOptions = ""
    containerOptions = "-B /om -B /om2 -B /net/storage001.ib.cluster/om2 -B /om/group/cpl"

    withLabel: 'local' {
        container = "file://${container_dir}/deepo-cpu.simg"
    }

    withLabel: 'om.*' {
        time = '1d'
    }

    withLabel: 'om_big' {
        memory = '32 GB'
    }

    withLabel: 'om_gpu.*' {
        time = '1d'
        /* clusterOptions = '--qos=cpl --gres=gpu:tesla-k80:1' */
        clusterOptions = '--gres=gpu:GEFORCEGTX1080TI:1'
        containerOptions = "-B /om -B /om2/user/jgauthie --nv"
    }

    withLabel: 'om_gpu_tf' {
        container = "file://${container_dir}/tf1.12-gpu.simg"
    }

    withLabel: "om_deepo" {
        container = "file://${container_dir}/deepo-cpu.simg"
    }
}

executor {
    $slurm {
        queueSize = 8
    }
}
